models:
  - name: dbt_baskets
    description: 'This table contains all the information on customer shopping
      baskets on our site. There is one basket per order'
    meta:
      label: Baskets
      groups:
        product_details:
          label: Product Details
          description: Fields that have information about the products in the basket.
        item_details:
          label: Item Details
          description: Fields that have informaton about the items in the basket.

    columns:
      - name: order_id
        description: 'Unique Order ID that the basket relates to.'
        meta:
          dimension:
            type: string
      - name: item_id
        description: 'ID for the product item within the basket.'
        meta:
          dimension:
            group: [ 'product_details', 'item_details' ]
            type: string
      - name: sku
        description: 'Unique Stock Keeping Unit code.'
        meta:
          dimension:
            type: number
      - name: product_name
        description: 'Full name of the product.'
        meta:
          dimension:
            label: 'Product name'
            group: [ 'product_details' ]
            type: string
          metrics:
            count_of_product_name:
              type: count
      - name: currency
        description: 'Three letter international currency code of the item price.'
        meta:
          dimension:
            type: string
      - name: item_price
        description: 'Price of the item in the specified currency.'
        meta:
          dimension:
            group: [ 'product_details', 'item_details' ]
            type: number
      - name: item_profit
        description: 'Profit made for the individual item.'
        meta:
          dimension:
            format: '[$$]#,##0'
            group: [ 'product_details', 'item_details' ]
            type: number
          additional_dimensions:
            item_profit_margin:
              type: number
              description: Item profit divided by item price
              sql: ${item_profit} / ${item_price}
            item_profit_margin_tier:
              type: string
              description: True if item has profit margin greater than 12%
              sql: |
                case 
                  when ${item_profit_margin} < .08 then 'Low profit margin' 
                  when ${item_profit_margin} > .12 then 'High profit margin'
                  else 'Mid profit margin' end
          metrics:
            sum_of_item_profit:
              type: sum
              format: '[$$]#,##0'
            average_of_item_profit:
              type: average
              label: 'Average item profit'
              format: '[$$]#,##0'
              description: 'The average of item profit. Apply this metric by week or month to see our average profit per item over a given time period'
      - name: basket_total
        description: 'Sum of item prices for each item within the basket.'
        meta:
          dimension:
            format: '[$$]#,##0'
            type: number
          metrics:
            sum_of_basket_total:
              type: sum
              label: 'Basket total'
              format: '[$$]#,##0'
              spotlight:
                visibility: show
                categories:
                  - verified
            average_of_basket_total:
              type: average
              label: 'Average basket total'
              format: '[$$]#,##0'
              description: 'The average of total basket values. Apply this metric by week or month to see our average basket total over a given time period'
              spotlight:
                visibility: show
                categories:
                  - verified
      - name: order_date
        description: 'Timestamp of order placement by the user.'
        meta:
          dimension:
            label: 'Order date'
            sql: >
              timestamp_add(
                ${TABLE}.order_date,
                interval timestamp_diff(current_timestamp(), timestamp '2025-02-13 00:00:00', second) second
              )
            type: timestamp
            time_intervals: [
              'HOUR', 'MINUTE_OF_HOUR_NUM', 'HOUR_OF_DAY_NUM',
              'DAY', 'DAY_OF_WEEK_INDEX', 'DAY_OF_MONTH_NUM', 'DAY_OF_YEAR_NUM', 
              'DAY_OF_WEEK_NAME', 'WEEK', 'WEEK_NUM', 
              'MONTH', 'MONTH_NUM', 'MONTH_NAME',
              'QUARTER', 'QUARTER_NUM', 'QUARTER_NAME',
              'YEAR' ]
          additional_dimensions:
            order_date_is_in_future:
              type: boolean
              description: True if order date is in the future, otherwise False
              sql: |
                case 
                  when ${TABLE}.order_date > current_date() 
                    then true
                  else false
                end
      - name: profit
        description: 'Sum of item profits within the basket. Thus, the total profit of the basket.'
        meta:
          dimension:
            format: '[$$]#,##0'
            type: number
      - name: partner_id
        description: 'Unique ID of the partner that is fulfilling the basket.'
        meta:
          dimension:
            type: number
      - name: partner_name
        description: 'Full name of the partner that is fulfilling the basket.'
        meta:
          dimension:
            label: 'Partner name'
            type: string
      - name: partner_commission
        description: 'The commission rate the specified parter charges, as a decimal
          fraction.'
        meta:
          dimension:
            type: number
